<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bioc="http://bpmn.io/schema/bpmn/biocolor/1.0" id="Definitions_19s0o48" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="4.6.0">
  <bpmn:collaboration id="Collaboration_076bpic">
    <bpmn:documentation>Дата фабрика</bpmn:documentation>
    <bpmn:participant id="Participant_16k8tsd" name="Оновлення даних про лабораторію" processRef="citizen-update-lab" />
  </bpmn:collaboration>
  <bpmn:process id="citizen-update-lab" name="Оновлення даних про лабораторію" isExecutable="true">
    <bpmn:laneSet id="LaneSet_0insh9e" />
    <bpmn:startEvent id="start_event" name="Початок" camunda:formKey="citizen-shared-search-lab" camunda:initiator="initiator">
      <bpmn:outgoing>Flow_14ae7b2</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:sequenceFlow id="Flow_041kh82" sourceRef="defineBusinessProcessStatusActivity" targetRef="Event_0xw0ca1" />
    <bpmn:sequenceFlow id="Flow_1t8c6oe" sourceRef="Event_1x8mg0g" targetRef="Gateway_1xtffx8" />
    <bpmn:sequenceFlow id="Flow_0hz7hdv" sourceRef="extractNameAndEdrpouFromUpdateLabFormActivity" targetRef="Gateway_038bgls" />
    <bpmn:sequenceFlow id="Flow_1ut6pfw" name="ні" sourceRef="Gateway_1qa6te9" targetRef="Gateway_0gqiwsr">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${response.value.responseBody.elements().isEmpty()}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_1gk3fzt" sourceRef="Gateway_0poyko1" targetRef="updateLabCitizenActivity" />
    <bpmn:sequenceFlow id="Flow_08wtjup" name="так" sourceRef="Gateway_1qa6te9" targetRef="Activity_00w3djy">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${!response.value.responseBody.elements().isEmpty()}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_1oda6vs" sourceRef="Activity_00w3djy" targetRef="Gateway_0poyko1" />
    <bpmn:sequenceFlow id="Flow_0qe6tpr" name="ні" sourceRef="Gateway_038bgls" targetRef="Gateway_0gqiwsr">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${oldName.value.equals(name.value)}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_09rm3a8" sourceRef="Gateway_0gqiwsr" targetRef="signLabCitizenActivity" />
    <bpmn:sequenceFlow id="Flow_14ae7b2" sourceRef="start_event" targetRef="Activity_1uqfaz3" />
    <bpmn:sequenceFlow id="Flow_1w1iczd" sourceRef="readLabFromDataFactoryActivity" targetRef="readKoatuuFromDataFactoryActivity" />
    <bpmn:sequenceFlow id="Flow_0yx6dt7" sourceRef="readKoatuuFromDataFactoryActivity" targetRef="readOblInfoFromDataFactoryActivity" />
    <bpmn:sequenceFlow id="Flow_1jl0egn" sourceRef="searchOblastFromDataFactoryActivity" targetRef="readOwnershipFromDataFactoryActivity" />
    <bpmn:sequenceFlow id="Flow_1ib47w7" sourceRef="readOwnershipFromDataFactoryActivity" targetRef="readKopfgFromDataFactoryActivity" />
    <bpmn:sequenceFlow id="Flow_091xock" sourceRef="readKopfgFromDataFactoryActivity" targetRef="convertLabDataToFormDataFormatActivity" />
    <bpmn:sequenceFlow id="Flow_0s14o5i" sourceRef="searchForLabByNameAndEdrpouActivity" targetRef="Gateway_1qa6te9" />
    <bpmn:sequenceFlow id="Flow_0dadnzp" name="так" sourceRef="Gateway_038bgls" targetRef="searchForLabByNameAndEdrpouActivity">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${!oldName.value.equals(name.value)}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_00oa0q7" sourceRef="updateLabInDataFactoryActivity" targetRef="defineBusinessProcessStatusActivity" />
    <bpmn:sequenceFlow id="Flow_0q71tz2" sourceRef="convertLabDataToFormDataFormatActivity" targetRef="viewLabDataCitizenActivity" />
    <bpmn:sequenceFlow id="Flow_0hvq8bh" sourceRef="viewLabDataCitizenActivity" targetRef="Gateway_0poyko1" />
    <bpmn:sequenceFlow id="Flow_115drxp" sourceRef="updateLabCitizenActivity" targetRef="extractNameAndEdrpouFromUpdateLabFormActivity" />
    <bpmn:sequenceFlow id="Flow_036idne" sourceRef="readOblInfoFromDataFactoryActivity" targetRef="searchOblastFromDataFactoryActivity" />
    <bpmn:sequenceFlow id="Flow_0zitjm3" sourceRef="Activity_0nik0z6" targetRef="Gateway_15xuz6u" />
    <bpmn:sequenceFlow id="Flow_0xpwkj4" name="так" sourceRef="Gateway_15xuz6u" targetRef="Activity_1ifpigd">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${responseEdr.value.responseBody.elements().get(0).prop('state').value().equals('SUSPENDED') || responseEdr.value.responseBody.elements().get(0).prop('state').value().equals('CANCELED')}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_1xk1hyj" sourceRef="checkLabOfficerActivity" targetRef="Gateway_10n86l0" />
    <bpmn:sequenceFlow id="Flow_05m4mjo" name="так" sourceRef="Gateway_10n86l0" targetRef="Gateway_1xtffx8">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${submission('checkLabOfficerActivity').formData.hasProp('labUniqueCheckFlag') &amp;&amp; submission('checkLabOfficerActivity').formData.prop('labUniqueCheckFlag').value() == true}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_1mlthic" sourceRef="Activity_1r6wdr7" targetRef="Event_1ndnthd" />
    <bpmn:sequenceFlow id="Flow_0bidc8n" name="Ні&#10;" sourceRef="Gateway_10n86l0" targetRef="Activity_1r6wdr7">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${!submission('checkLabOfficerActivity').formData.hasProp('labUniqueCheckFlag') || submission('checkLabOfficerActivity').formData.prop('labUniqueCheckFlag').value() == false}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_1dbduou" sourceRef="Activity_053sdul" targetRef="Activity_0i7keo5" />
    <bpmn:sequenceFlow id="Flow_0ffo76w" sourceRef="signLabOfficerActivity" targetRef="Activity_053sdul" />
    <bpmn:sequenceFlow id="Flow_10uyhtq" sourceRef="Activity_0i7keo5" targetRef="updateLabInDataFactoryActivity" />
    <bpmn:sequenceFlow id="Flow_14izlt5" sourceRef="signLabCitizenActivity" targetRef="Activity_07tb75z" />
    <bpmn:sequenceFlow id="Flow_1kkl3aw" sourceRef="Activity_1m00e6x" targetRef="checkLabOfficerActivity" />
    <bpmn:sequenceFlow id="Flow_0nanpaq" sourceRef="Activity_07tb75z" targetRef="dispatchTaskActivity" />
    <bpmn:sequenceFlow id="Flow_0lihb2z" sourceRef="dispatchTaskActivity" targetRef="Activity_1m00e6x" />
    <bpmn:sequenceFlow id="Flow_0sgyv1j" sourceRef="Activity_1ifpigd" targetRef="Event_12fj472" />
    <bpmn:sequenceFlow id="Flow_0cievp1" name="ні" sourceRef="Gateway_15xuz6u" targetRef="Gateway_18ns2is">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${!responseEdr.value.responseBody.elements().get(0).prop('state').value().equals('SUSPENDED') &amp;&amp; !responseEdr.value.responseBody.elements().get(0).prop('state').value().equals('CANCELED')}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_0zmdl59" sourceRef="Gateway_1xtffx8" targetRef="signLabOfficerActivity" />
    <bpmn:exclusiveGateway id="Gateway_15xuz6u" name="state != - 1 (&#34;скасовано&#34;), 3 (&#34;припинено&#34;)">
      <bpmn:incoming>Flow_0zitjm3</bpmn:incoming>
      <bpmn:outgoing>Flow_0xpwkj4</bpmn:outgoing>
      <bpmn:outgoing>Flow_0cievp1</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:serviceTask id="Activity_0nik0z6" name="Читання даних з ЄДР" camunda:modelerTemplate="searchSubjectsEdrRegistryConnectorDelegate" camunda:delegateExpression="${searchSubjectsEdrRegistryConnectorDelegate}">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="passport" />
          <camunda:inputParameter name="name" />
          <camunda:inputParameter name="authorizationToken">token</camunda:inputParameter>
          <camunda:inputParameter name="code">${initiator().edrpou}</camunda:inputParameter>
          <camunda:outputParameter name="responseEdr">${ response }</camunda:outputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_17io2e9</bpmn:incoming>
      <bpmn:outgoing>Flow_0zitjm3</bpmn:outgoing>
      <bpmn:property id="Property_1tfa7i7" name="__targetRef_placeholder" />
    </bpmn:serviceTask>
    <bpmn:serviceTask id="Activity_1ifpigd" name="Формування валідаційної помилки" camunda:modelerTemplate="userDataValidationErrorDelegate" camunda:delegateExpression="${userDataValidationErrorDelegate}">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="validationErrors">
            <camunda:list>
              <camunda:value>{"field": "", "value": "", "message": "Суб'єкт скасовано або припинено"}</camunda:value>
            </camunda:list>
          </camunda:inputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0xpwkj4</bpmn:incoming>
      <bpmn:outgoing>Flow_0sgyv1j</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:dataStoreReference id="DataStoreReference_1avq00l" name="Дата фабрика" />
    <bpmn:scriptTask id="convertLabDataToFormDataFormatActivity" name="Підготовка даних для запису (transient var)" scriptFormat="groovy">
      <bpmn:incoming>Flow_091xock</bpmn:incoming>
      <bpmn:outgoing>Flow_0q71tz2</bpmn:outgoing>
      <bpmn:script>import groovy.json.JsonSlurper

def slurper = new JsonSlurper()

def cephData = [:]
labResponse.responseBody.fieldNames()
  .stream()
  .filter(it -&gt; !it.equals('premisesFile') &amp;&amp; !it.equals('accreditationFile'))
  .each {
    cephData[it] = labResponse.responseBody.prop(it).value()
  }

cephData.remove('koatuuId')
cephData.remove('ownershipId')
cephData.remove('kopfgId')

cephData['oblast'] = slurper.parseText(oblResponse.responseBody.toString())
cephData['koatuu'] = slurper.parseText(koatuuResponse.responseBody.toString())
cephData['ownership'] = slurper.parseText(ownershipResponse.responseBody.toString())
cephData['kopfg'] = slurper.parseText(kopfgResponse.responseBody.toString())

if(labResponse.responseBody.hasProp('premisesFile') &amp;&amp; !labResponse.responseBody.prop('premisesFile').isNull()) {
  cephData['premisesFile'] = [slurper.parseText(labResponse.responseBody.prop('premisesFile').toString())]
}

if(labResponse.responseBody.hasProp('accreditationFile') &amp;&amp; !labResponse.responseBody.prop('accreditationFile').isNull()) {
  cephData['accreditationFile'] = [slurper.parseText(labResponse.responseBody.prop('accreditationFile').toString())]
}

execution.removeVariable('payload')
set_transient_variable('payload', S(cephData, 'application/json'))

execution.setVariable('laboratoryId', labResponse.responseBody.prop('laboratoryId').value())</bpmn:script>
    </bpmn:scriptTask>
    <bpmn:serviceTask id="readLabFromDataFactoryActivity" name="Запит даних про лабораторію" camunda:modelerTemplate="dataFactoryConnectorReadDelegate" camunda:delegateExpression="${dataFactoryConnectorReadDelegate}">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="resource">laboratory</camunda:inputParameter>
          <camunda:inputParameter name="id">${submission('start_event').formData.prop('laboratory').prop('laboratoryId').value()}</camunda:inputParameter>
          <camunda:inputParameter name="x_access_token">${initiator().accessToken}</camunda:inputParameter>
          <camunda:outputParameter name="labResponse">${ response }</camunda:outputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_13vj5be</bpmn:incoming>
      <bpmn:outgoing>Flow_1w1iczd</bpmn:outgoing>
      <bpmn:dataOutputAssociation id="DataOutputAssociation_1opc1nc">
        <bpmn:targetRef>DataStoreReference_1avq00l</bpmn:targetRef>
      </bpmn:dataOutputAssociation>
    </bpmn:serviceTask>
    <bpmn:serviceTask id="readKoatuuFromDataFactoryActivity" name="Запит даних про населенний пункт" camunda:modelerTemplate="dataFactoryConnectorReadDelegate" camunda:delegateExpression="${dataFactoryConnectorReadDelegate}">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="resource">koatuu</camunda:inputParameter>
          <camunda:inputParameter name="id">${labResponse.value.responseBody.prop('koatuuId').value()}</camunda:inputParameter>
          <camunda:inputParameter name="x_access_token">${initiator().accessToken}</camunda:inputParameter>
          <camunda:outputParameter name="koatuuResponse">${ response }</camunda:outputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1w1iczd</bpmn:incoming>
      <bpmn:outgoing>Flow_0yx6dt7</bpmn:outgoing>
      <bpmn:dataOutputAssociation id="DataOutputAssociation_02aoa2p">
        <bpmn:targetRef>DataStoreReference_1897i2u</bpmn:targetRef>
      </bpmn:dataOutputAssociation>
    </bpmn:serviceTask>
    <bpmn:dataStoreReference id="DataStoreReference_1897i2u" name="Дата фабрика" />
    <bpmn:serviceTask id="searchOblastFromDataFactoryActivity" name="Запит данних про область" camunda:modelerTemplate="dataFactoryConnectorReadDelegate" camunda:delegateExpression="${dataFactoryConnectorReadDelegate}">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="resource">koatuu</camunda:inputParameter>
          <camunda:inputParameter name="id">${searchOblResponse.value.responseBody.elements()[0].prop('koatuuIdObl').value()}</camunda:inputParameter>
          <camunda:inputParameter name="x_access_token">${initiator().accessToken}</camunda:inputParameter>
          <camunda:outputParameter name="oblResponse">${ response }</camunda:outputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_036idne</bpmn:incoming>
      <bpmn:outgoing>Flow_1jl0egn</bpmn:outgoing>
      <bpmn:dataOutputAssociation id="DataOutputAssociation_082rwwv">
        <bpmn:targetRef>DataStoreReference_03zzx1o</bpmn:targetRef>
      </bpmn:dataOutputAssociation>
    </bpmn:serviceTask>
    <bpmn:serviceTask id="readOwnershipFromDataFactoryActivity" name="Запит данних про форму власності" camunda:modelerTemplate="dataFactoryConnectorReadDelegate" camunda:delegateExpression="${dataFactoryConnectorReadDelegate}">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="resource">ownership</camunda:inputParameter>
          <camunda:inputParameter name="id">${labResponse.value.responseBody.prop('ownershipId').value()}</camunda:inputParameter>
          <camunda:inputParameter name="x_access_token">${initiator().accessToken}</camunda:inputParameter>
          <camunda:outputParameter name="ownershipResponse">${ response }</camunda:outputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1jl0egn</bpmn:incoming>
      <bpmn:outgoing>Flow_1ib47w7</bpmn:outgoing>
      <bpmn:dataOutputAssociation id="DataOutputAssociation_1y4pmyb">
        <bpmn:targetRef>DataStoreReference_1bqcew5</bpmn:targetRef>
      </bpmn:dataOutputAssociation>
    </bpmn:serviceTask>
    <bpmn:serviceTask id="readKopfgFromDataFactoryActivity" name="Запит данних про організаційно-правову форму" camunda:modelerTemplate="dataFactoryConnectorReadDelegate" camunda:delegateExpression="${dataFactoryConnectorReadDelegate}">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="resource">kopfg</camunda:inputParameter>
          <camunda:inputParameter name="id">${labResponse.value.responseBody.prop('kopfgId').value()}</camunda:inputParameter>
          <camunda:inputParameter name="x_access_token">${initiator().accessToken}</camunda:inputParameter>
          <camunda:outputParameter name="kopfgResponse">${ response }</camunda:outputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1ib47w7</bpmn:incoming>
      <bpmn:outgoing>Flow_091xock</bpmn:outgoing>
      <bpmn:dataOutputAssociation id="DataOutputAssociation_14al9rj">
        <bpmn:targetRef>DataStoreReference_0v7wv16</bpmn:targetRef>
      </bpmn:dataOutputAssociation>
    </bpmn:serviceTask>
    <bpmn:userTask id="viewLabDataCitizenActivity" name="Відобразити дані про лабораторію" camunda:modelerTemplate="formUserTaskTemplate" camunda:formKey="read-lab-data-bp-view-lab-data" camunda:assignee="${initiator}">
      <bpmn:extensionElements>
        <camunda:properties>
          <camunda:property name="eSign" value="" />
        </camunda:properties>
        <camunda:inputOutput>
          <camunda:inputParameter name="userTaskInputFormDataPrepopulate">${payload}</camunda:inputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0q71tz2</bpmn:incoming>
      <bpmn:outgoing>Flow_0hvq8bh</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:userTask id="updateLabCitizenActivity" name="Оновити дані про лабораторію" camunda:modelerTemplate="formUserTaskTemplate" camunda:formKey="citizen-update-lab-bp-change-lab-data" camunda:assignee="${initiator}">
      <bpmn:extensionElements>
        <camunda:properties>
          <camunda:property name="eSign" value="" />
        </camunda:properties>
        <camunda:inputOutput>
          <camunda:inputParameter name="userTaskInputFormDataPrepopulate">${submission('viewLabDataCitizenActivity').formData}</camunda:inputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1gk3fzt</bpmn:incoming>
      <bpmn:outgoing>Flow_115drxp</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:exclusiveGateway id="Gateway_0poyko1">
      <bpmn:incoming>Flow_1oda6vs</bpmn:incoming>
      <bpmn:incoming>Flow_0hvq8bh</bpmn:incoming>
      <bpmn:outgoing>Flow_1gk3fzt</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:scriptTask id="extractNameAndEdrpouFromUpdateLabFormActivity" name="Підготовка зміних для отримання запису" scriptFormat="groovy">
      <bpmn:incoming>Flow_115drxp</bpmn:incoming>
      <bpmn:outgoing>Flow_0hz7hdv</bpmn:outgoing>
      <bpmn:script>var name = submission('updateLabCitizenActivity').formData.prop('name').stringValue()
        var edrpou = submission('updateLabCitizenActivity').formData.prop('edrpou').stringValue()

        execution.removeVariable('name')
        execution.removeVariable('edrpou')
        set_transient_variable('name', name)
        set_transient_variable('edrpou', edrpou)

        var oldName = submission('viewLabDataCitizenActivity').formData.prop('name').stringValue()
        execution.removeVariable('oldName')
        set_transient_variable('oldName', oldName)</bpmn:script>
    </bpmn:scriptTask>
    <bpmn:exclusiveGateway id="Gateway_038bgls" name="Назву лабораторії змінено?">
      <bpmn:incoming>Flow_0hz7hdv</bpmn:incoming>
      <bpmn:outgoing>Flow_0qe6tpr</bpmn:outgoing>
      <bpmn:outgoing>Flow_0dadnzp</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:exclusiveGateway id="Gateway_1qa6te9" name="Дані присутні?">
      <bpmn:incoming>Flow_0s14o5i</bpmn:incoming>
      <bpmn:outgoing>Flow_1ut6pfw</bpmn:outgoing>
      <bpmn:outgoing>Flow_08wtjup</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:serviceTask id="Activity_00w3djy" name="Формування валідаційної помилки" camunda:modelerTemplate="userDataValidationErrorDelegate" camunda:delegateExpression="${userDataValidationErrorDelegate}">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="validationErrors">
            <camunda:list>
              <camunda:value>{"field": "name", "value": "${name.value.replaceAll("\"", "\\\\\"")}", "message": "Дані про цю лабораторію вже присутні"}</camunda:value>
            </camunda:list>
          </camunda:inputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_08wtjup</bpmn:incoming>
      <bpmn:outgoing>Flow_1oda6vs</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:serviceTask id="searchForLabByNameAndEdrpouActivity" name="Пошук даних про лабораторію" camunda:modelerTemplate="dataFactoryConnectorSearchDelegate" camunda:delegateExpression="${dataFactoryConnectorSearchDelegate}">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="resource">laboratory-equal-edrpou-name-count</camunda:inputParameter>
          <camunda:inputParameter name="searchConditions">
            <camunda:map>
              <camunda:entry key="name">${name.value}</camunda:entry>
              <camunda:entry key="edrpou">${edrpou.value}</camunda:entry>
            </camunda:map>
          </camunda:inputParameter>
          <camunda:inputParameter name="x_access_token">${completer('updateLabCitizenActivity').accessToken}</camunda:inputParameter>
          <camunda:outputParameter name="response">${ response }</camunda:outputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0dadnzp</bpmn:incoming>
      <bpmn:outgoing>Flow_0s14o5i</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:serviceTask id="readOblInfoFromDataFactoryActivity" name="Пошук інформації про id області" camunda:modelerTemplate="dataFactoryConnectorSearchDelegate" camunda:delegateExpression="${dataFactoryConnectorSearchDelegate}">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="resource">koatuu-equal-koatuu-id-name</camunda:inputParameter>
          <camunda:inputParameter name="searchConditions">
            <camunda:map>
              <camunda:entry key="koatuuId">${labResponse.value.responseBody.prop('koatuuId').value()}</camunda:entry>
            </camunda:map>
          </camunda:inputParameter>
          <camunda:inputParameter name="x_access_token">${initiator().accessToken}</camunda:inputParameter>
          <camunda:outputParameter name="searchOblResponse">${ response }</camunda:outputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0yx6dt7</bpmn:incoming>
      <bpmn:outgoing>Flow_036idne</bpmn:outgoing>
      <bpmn:dataOutputAssociation id="DataOutputAssociation_0epgu5f">
        <bpmn:targetRef>DataStoreReference_0sbg7eh</bpmn:targetRef>
      </bpmn:dataOutputAssociation>
    </bpmn:serviceTask>
    <bpmn:exclusiveGateway id="Gateway_0gqiwsr">
      <bpmn:incoming>Flow_0qe6tpr</bpmn:incoming>
      <bpmn:incoming>Flow_1ut6pfw</bpmn:incoming>
      <bpmn:outgoing>Flow_09rm3a8</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:userTask id="signLabCitizenActivity" name="Підписати дані КЕП" camunda:modelerTemplate="citizenSignTaskTemplate" camunda:formKey="shared-citizen-sign-lab" camunda:assignee="${initiator}">
      <bpmn:extensionElements>
        <camunda:properties>
          <camunda:property name="formVariables" value="" />
          <camunda:property name="eSign" value="true" />
          <camunda:property name="INDIVIDUAL" value="" />
          <camunda:property name="ENTREPRENEUR" value="true" />
          <camunda:property name="LEGAL" value="true" />
        </camunda:properties>
        <camunda:inputOutput>
          <camunda:inputParameter name="userTaskInputFormDataPrepopulate">${submission('updateLabCitizenActivity').formData}</camunda:inputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_09rm3a8</bpmn:incoming>
      <bpmn:outgoing>Flow_14izlt5</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:serviceTask id="Activity_07tb75z" name="Отримання користувачів з ролью &#39;officer&#39;" camunda:modelerTemplate="getUsersByRoleFromKeycloak" camunda:delegateExpression="${keycloakGetUsersConnectorDelegate}">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="role_name" />
          <camunda:outputParameter name="officerUsers">${ usersByRole }</camunda:outputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_14izlt5</bpmn:incoming>
      <bpmn:outgoing>Flow_0nanpaq</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:userTask id="dispatchTaskActivity" name="Призначення виконавця задачі &#34;Перевірка на відповідність документів!" camunda:modelerTemplate="formUserTaskTemplate" camunda:formKey="shared-dispatch-task" camunda:assignee="" camunda:candidateGroups="task-dispatcher">
      <bpmn:extensionElements>
        <camunda:properties>
          <camunda:property name="formVariables" value="officerUsers" />
        </camunda:properties>
        <camunda:inputOutput>
          <camunda:inputParameter name="userTaskInputFormDataPrepopulate" />
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0nanpaq</bpmn:incoming>
      <bpmn:outgoing>Flow_0lihb2z</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:scriptTask id="Activity_1m00e6x" name="Підготовка даних документа для показу" scriptFormat="groovy">
      <bpmn:incoming>Flow_0lihb2z</bpmn:incoming>
      <bpmn:outgoing>Flow_1kkl3aw</bpmn:outgoing>
      <bpmn:script>execution.removeVariable('officerAssignee')
execution.setVariable('officerAssignee', submission('dispatchTaskActivity').formData.prop('userTaskAssignee').prop('userName').value())</bpmn:script>
    </bpmn:scriptTask>
    <bpmn:dataStoreReference id="DataStoreReference_0sbg7eh" name="Дата фабрика" />
    <bpmn:dataStoreReference id="DataStoreReference_03zzx1o" name="Дата фабрика" />
    <bpmn:dataStoreReference id="DataStoreReference_1bqcew5" name="Дата фабрика" />
    <bpmn:dataStoreReference id="DataStoreReference_0v7wv16" name="Дата фабрика" />
    <bpmn:userTask id="checkLabOfficerActivity" name="Перевірка унікальности запису про лабораторію" camunda:modelerTemplate="formUserTaskTemplate" camunda:formKey="shared-officer-check-lab" camunda:assignee="${officerAssignee}" camunda:candidateGroups="">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="userTaskInputFormDataPrepopulate">${submission('signLabCitizenActivity').formData}</camunda:inputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1kkl3aw</bpmn:incoming>
      <bpmn:outgoing>Flow_1xk1hyj</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:exclusiveGateway id="Gateway_10n86l0" name="Лабораторія Унікальна? labUniqueCheckFlag">
      <bpmn:incoming>Flow_1xk1hyj</bpmn:incoming>
      <bpmn:outgoing>Flow_05m4mjo</bpmn:outgoing>
      <bpmn:outgoing>Flow_0bidc8n</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:serviceTask id="defineBusinessProcessStatusActivity" name="Результат виконання &#34;Дані про лабораторію оновлені&#34;" camunda:modelerTemplate="defineBusinessProcessStatusDelegate" camunda:delegateExpression="${defineBusinessProcessStatusDelegate}">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="status">Дані про лабораторію оновлені</camunda:inputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_00oa0q7</bpmn:incoming>
      <bpmn:outgoing>Flow_041kh82</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:endEvent id="Event_0xw0ca1" name="Дані оновлені">
      <bpmn:incoming>Flow_041kh82</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:dataStoreReference id="DataStoreReference_0ftohld" name="Дата фабрика" />
    <bpmn:serviceTask id="updateLabInDataFactoryActivity" name="Зберегти дані в Дата фабрику" camunda:modelerTemplate="dataFactoryConnectorUpdateDelegate" camunda:delegateExpression="${dataFactoryConnectorUpdateDelegate}">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="resource">laboratory</camunda:inputParameter>
          <camunda:inputParameter name="id">${laboratoryId}</camunda:inputParameter>
          <camunda:inputParameter name="payload">${dataPayload}</camunda:inputParameter>
          <camunda:inputParameter name="x_digital_signature_derived_ceph_key">${system_signature_ceph_key}</camunda:inputParameter>
          <camunda:inputParameter name="x_access_token">${completer('signLabOfficerActivity').accessToken}</camunda:inputParameter>
          <camunda:inputParameter name="x_digital_signature_ceph_key">${sign_submission('signLabOfficerActivity').signatureDocumentId}</camunda:inputParameter>
          <camunda:outputParameter name="response">${ response }</camunda:outputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_10uyhtq</bpmn:incoming>
      <bpmn:outgoing>Flow_00oa0q7</bpmn:outgoing>
      <bpmn:dataOutputAssociation id="DataOutputAssociation_13oebk7">
        <bpmn:targetRef>DataStoreReference_0ftohld</bpmn:targetRef>
      </bpmn:dataOutputAssociation>
    </bpmn:serviceTask>
    <bpmn:endEvent id="Event_12fj472" name="Дані не оновлені">
      <bpmn:incoming>Flow_0sgyv1j</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:serviceTask id="Activity_1r6wdr7" name="Результат виконання &#34;Дані про лабораторію не оновлені&#34;" camunda:modelerTemplate="defineBusinessProcessStatusDelegate" camunda:delegateExpression="${defineBusinessProcessStatusDelegate}">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="status">Дані про лабораторію не оновлені - Така лабораторія вже існує</camunda:inputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0bidc8n</bpmn:incoming>
      <bpmn:outgoing>Flow_1mlthic</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:endEvent id="Event_1ndnthd" name="Дані не оновлені">
      <bpmn:incoming>Flow_1mlthic</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:userTask id="signLabOfficerActivity" name="Підписати дані лабораторії" camunda:modelerTemplate="officerSignTaskTemplate" camunda:formKey="shared-officer-sign-lab" camunda:assignee="${officerAssignee}" camunda:candidateGroups="">
      <bpmn:extensionElements>
        <camunda:properties>
          <camunda:property name="eSign" value="true" />
        </camunda:properties>
        <camunda:inputOutput>
          <camunda:inputParameter name="userTaskInputFormDataPrepopulate">${submission('checkLabOfficerActivity').formData}</camunda:inputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0zmdl59</bpmn:incoming>
      <bpmn:outgoing>Flow_0ffo76w</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:scriptTask id="Activity_053sdul" name="Підготовка даних для запису (transient var)" scriptFormat="groovy">
      <bpmn:incoming>Flow_0ffo76w</bpmn:incoming>
      <bpmn:outgoing>Flow_1dbduou</bpmn:outgoing>
      <bpmn:script>def signedFormData = submission('signLabOfficerActivity').formData

        signedFormData.prop('oblast', signedFormData.prop('oblast').prop('code').value())

        signedFormData.prop('koatuuId', signedFormData.prop('koatuu').prop('koatuuId').value())
        signedFormData.deleteProp('koatuu')
        signedFormData.prop('ownershipId', signedFormData.prop('ownership').prop('ownershipId').value())
        signedFormData.deleteProp('ownership')
        signedFormData.prop('kopfgId', signedFormData.prop('kopfg').prop('kopfgId').value())
        signedFormData.deleteProp('kopfg')

if(signedFormData.hasProp('premisesFile') &amp;&amp; !signedFormData.prop('premisesFile').isNull() &amp;&amp;
!signedFormData.prop('premisesFile').elements().isEmpty()) {
  signedFormData.prop('premisesFile', signedFormData.prop('premisesFile').elements()[0])  
} else {
 signedFormData.prop('premisesFile', null as String)
}

if(signedFormData.hasProp('accreditationFile') &amp;&amp; !signedFormData.prop('accreditationFile').isNull() &amp;&amp; !signedFormData.prop('accreditationFile').elements().isEmpty()) {
  signedFormData.prop('accreditationFile', signedFormData.prop('accreditationFile').elements()[0])  
} else {
 signedFormData.prop('accreditationFile', null as String)
}


        execution.removeVariable('dataPayload')
        set_transient_variable('dataPayload', signedFormData)</bpmn:script>
    </bpmn:scriptTask>
    <bpmn:callActivity id="Activity_0i7keo5" name="Підписати дані системним ключем" calledElement="system-signature-bp">
      <bpmn:extensionElements>
        <camunda:in source="dataPayload" target="dataToSign" />
        <camunda:out source="system_signature_ceph_key" target="system_signature_ceph_key" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1dbduou</bpmn:incoming>
      <bpmn:outgoing>Flow_10uyhtq</bpmn:outgoing>
    </bpmn:callActivity>
    <bpmn:exclusiveGateway id="Gateway_1xtffx8">
      <bpmn:incoming>Flow_05m4mjo</bpmn:incoming>
      <bpmn:incoming>Flow_1t8c6oe</bpmn:incoming>
      <bpmn:outgoing>Flow_0zmdl59</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:boundaryEvent id="Event_1x8mg0g" attachedToRef="updateLabInDataFactoryActivity">
      <bpmn:outgoing>Flow_1t8c6oe</bpmn:outgoing>
      <bpmn:errorEventDefinition id="ErrorEventDefinition_0w47876" />
    </bpmn:boundaryEvent>
    <bpmn:exclusiveGateway id="Gateway_18ns2is">
      <bpmn:incoming>Flow_0cievp1</bpmn:incoming>
      <bpmn:incoming>Flow_0fqnb49</bpmn:incoming>
      <bpmn:outgoing>Flow_13vj5be</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_13vj5be" sourceRef="Gateway_18ns2is" targetRef="readLabFromDataFactoryActivity" />
    <bpmn:exclusiveGateway id="Gateway_08hyjfl" name="edrAbsentFlag">
      <bpmn:incoming>Flow_0nouh1f</bpmn:incoming>
      <bpmn:outgoing>Flow_17io2e9</bpmn:outgoing>
      <bpmn:outgoing>Flow_0fqnb49</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:serviceTask id="Activity_1uqfaz3" name="Пошук суб&#39;єкту" camunda:modelerTemplate="dataFactoryConnectorReadDelegate" camunda:delegateExpression="${dataFactoryConnectorReadDelegate}">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="resource">subject</camunda:inputParameter>
          <camunda:inputParameter name="x_access_token">${initiator().accessToken}</camunda:inputParameter>
          <camunda:inputParameter name="id">${submission('start_event').formData.prop('laboratory').prop('subjectId').value()}</camunda:inputParameter>
          <camunda:outputParameter name="subjectResponse">${ response }</camunda:outputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_14ae7b2</bpmn:incoming>
      <bpmn:outgoing>Flow_0nouh1f</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_0nouh1f" sourceRef="Activity_1uqfaz3" targetRef="Gateway_08hyjfl" />
    <bpmn:sequenceFlow id="Flow_17io2e9" name="false" sourceRef="Gateway_08hyjfl" targetRef="Activity_0nik0z6">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${!subjectResponse.value.responseBody.prop('absentEdrFlag').boolValue()}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_0fqnb49" name="true" sourceRef="Gateway_08hyjfl" targetRef="Gateway_18ns2is">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${subjectResponse.value.responseBody.prop('absentEdrFlag').boolValue()}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
  </bpmn:process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Collaboration_076bpic">
      <bpmndi:BPMNShape id="Participant_16k8tsd_di" bpmnElement="Participant_16k8tsd" isHorizontal="true">
        <dc:Bounds x="160" y="80" width="4278" height="730" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_0fqnb49_di" bpmnElement="Flow_0fqnb49">
        <di:waypoint x="470" y="245" />
        <di:waypoint x="470" y="150" />
        <di:waypoint x="860" y="150" />
        <di:waypoint x="860" y="245" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="656" y="132" width="19" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_17io2e9_di" bpmnElement="Flow_17io2e9">
        <di:waypoint x="495" y="270" />
        <di:waypoint x="570" y="270" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="521" y="252" width="23" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0nouh1f_di" bpmnElement="Flow_0nouh1f">
        <di:waypoint x="400" y="270" />
        <di:waypoint x="445" y="270" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_13vj5be_di" bpmnElement="Flow_13vj5be">
        <di:waypoint x="885" y="270" />
        <di:waypoint x="918" y="270" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0zmdl59_di" bpmnElement="Flow_0zmdl59">
        <di:waypoint x="3645" y="270" />
        <di:waypoint x="3720" y="270" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0cievp1_di" bpmnElement="Flow_0cievp1">
        <di:waypoint x="775" y="270" />
        <di:waypoint x="835" y="270" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="788" y="252" width="9" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0sgyv1j_di" bpmnElement="Flow_0sgyv1j">
        <di:waypoint x="750" y="510" />
        <di:waypoint x="750" y="590" />
        <di:waypoint x="4370" y="590" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0lihb2z_di" bpmnElement="Flow_0lihb2z">
        <di:waypoint x="3200" y="270" />
        <di:waypoint x="3230" y="270" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0nanpaq_di" bpmnElement="Flow_0nanpaq">
        <di:waypoint x="3060" y="270" />
        <di:waypoint x="3100" y="270" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1kkl3aw_di" bpmnElement="Flow_1kkl3aw">
        <di:waypoint x="3330" y="270" />
        <di:waypoint x="3370" y="270" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_14izlt5_di" bpmnElement="Flow_14izlt5">
        <di:waypoint x="2925" y="270" />
        <di:waypoint x="2960" y="270" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_10uyhtq_di" bpmnElement="Flow_10uyhtq">
        <di:waypoint x="4060" y="270" />
        <di:waypoint x="4080" y="270" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0ffo76w_di" bpmnElement="Flow_0ffo76w">
        <di:waypoint x="3820" y="270" />
        <di:waypoint x="3840" y="270" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1dbduou_di" bpmnElement="Flow_1dbduou">
        <di:waypoint x="3940" y="270" />
        <di:waypoint x="3960" y="270" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0bidc8n_di" bpmnElement="Flow_0bidc8n">
        <di:waypoint x="3520" y="295" />
        <di:waypoint x="3520" y="470" />
        <di:waypoint x="4208" y="470" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="3530" y="380" width="11" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1mlthic_di" bpmnElement="Flow_1mlthic">
        <di:waypoint x="4308" y="470" />
        <di:waypoint x="4362" y="470" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_05m4mjo_di" bpmnElement="Flow_05m4mjo">
        <di:waypoint x="3545" y="270" />
        <di:waypoint x="3595" y="270" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="3556" y="252" width="16" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1xk1hyj_di" bpmnElement="Flow_1xk1hyj">
        <di:waypoint x="3470" y="270" />
        <di:waypoint x="3495" y="270" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0xpwkj4_di" bpmnElement="Flow_0xpwkj4">
        <di:waypoint x="750" y="295" />
        <di:waypoint x="750" y="430" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="772" y="409" width="16" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0zitjm3_di" bpmnElement="Flow_0zitjm3">
        <di:waypoint x="670" y="270" />
        <di:waypoint x="725" y="270" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_036idne_di" bpmnElement="Flow_036idne">
        <di:waypoint x="1290" y="270" />
        <di:waypoint x="1330" y="270" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_115drxp_di" bpmnElement="Flow_115drxp">
        <di:waypoint x="2238" y="270" />
        <di:waypoint x="2278" y="270" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0hvq8bh_di" bpmnElement="Flow_0hvq8bh">
        <di:waypoint x="2008" y="270" />
        <di:waypoint x="2043" y="270" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0q71tz2_di" bpmnElement="Flow_0q71tz2">
        <di:waypoint x="1858" y="270" />
        <di:waypoint x="1908" y="270" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_00oa0q7_di" bpmnElement="Flow_00oa0q7">
        <di:waypoint x="4180" y="270" />
        <di:waypoint x="4208" y="270" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0dadnzp_di" bpmnElement="Flow_0dadnzp">
        <di:waypoint x="2473" y="270" />
        <di:waypoint x="2520" y="270" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="2489" y="252" width="16" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0s14o5i_di" bpmnElement="Flow_0s14o5i">
        <di:waypoint x="2620" y="270" />
        <di:waypoint x="2663" y="270" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_091xock_di" bpmnElement="Flow_091xock">
        <di:waypoint x="1710" y="270" />
        <di:waypoint x="1758" y="270" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1ib47w7_di" bpmnElement="Flow_1ib47w7">
        <di:waypoint x="1570" y="270" />
        <di:waypoint x="1610" y="270" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1jl0egn_di" bpmnElement="Flow_1jl0egn">
        <di:waypoint x="1430" y="270" />
        <di:waypoint x="1470" y="270" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0yx6dt7_di" bpmnElement="Flow_0yx6dt7">
        <di:waypoint x="1150" y="270" />
        <di:waypoint x="1190" y="270" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1w1iczd_di" bpmnElement="Flow_1w1iczd">
        <di:waypoint x="1018" y="270" />
        <di:waypoint x="1050" y="270" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_14ae7b2_di" bpmnElement="Flow_14ae7b2">
        <di:waypoint x="266" y="270" />
        <di:waypoint x="300" y="270" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_09rm3a8_di" bpmnElement="Flow_09rm3a8">
        <di:waypoint x="2793" y="270" />
        <di:waypoint x="2825" y="270" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0qe6tpr_di" bpmnElement="Flow_0qe6tpr">
        <di:waypoint x="2448" y="295" />
        <di:waypoint x="2448" y="370" />
        <di:waypoint x="2768" y="370" />
        <di:waypoint x="2768" y="295" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="2435" y="323" width="9" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1oda6vs_di" bpmnElement="Flow_1oda6vs">
        <di:waypoint x="2528" y="160" />
        <di:waypoint x="2068" y="160" />
        <di:waypoint x="2068" y="245" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_08wtjup_di" bpmnElement="Flow_08wtjup">
        <di:waypoint x="2688" y="245" />
        <di:waypoint x="2688" y="160" />
        <di:waypoint x="2628" y="160" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="2656" y="137" width="16" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1gk3fzt_di" bpmnElement="Flow_1gk3fzt">
        <di:waypoint x="2093" y="270" />
        <di:waypoint x="2138" y="270" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1ut6pfw_di" bpmnElement="Flow_1ut6pfw">
        <di:waypoint x="2713" y="270" />
        <di:waypoint x="2743" y="270" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="2718" y="252" width="9" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0hz7hdv_di" bpmnElement="Flow_0hz7hdv">
        <di:waypoint x="2378" y="270" />
        <di:waypoint x="2423" y="270" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1t8c6oe_di" bpmnElement="Flow_1t8c6oe">
        <di:waypoint x="4130" y="212" />
        <di:waypoint x="4130" y="140" />
        <di:waypoint x="3620" y="140" />
        <di:waypoint x="3620" y="245" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_041kh82_di" bpmnElement="Flow_041kh82">
        <di:waypoint x="4308" y="270" />
        <di:waypoint x="4370" y="270" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="Event_0garqs8_di" bpmnElement="start_event" bioc:stroke="rgb(251, 140, 0)" bioc:fill="rgb(255, 224, 178)">
        <dc:Bounds x="230" y="252" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="229" y="295" width="43" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_15xuz6u_di" bpmnElement="Gateway_15xuz6u" isMarkerVisible="true">
        <dc:Bounds x="725" y="245" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="707" y="195" width="86" height="40" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0nik0z6_di" bpmnElement="Activity_0nik0z6">
        <dc:Bounds x="570" y="230" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1ifpigd_di" bpmnElement="Activity_1ifpigd">
        <dc:Bounds x="700" y="430" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="DataStoreReference_1avq00l_di" bpmnElement="DataStoreReference_1avq00l">
        <dc:Bounds x="943" y="365" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="932" y="422" width="72" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1kcv02r_di" bpmnElement="convertLabDataToFormDataFormatActivity">
        <dc:Bounds x="1758" y="230" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_10nfa7m_di" bpmnElement="readLabFromDataFactoryActivity">
        <dc:Bounds x="918" y="230" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0y72w3r_di" bpmnElement="readKoatuuFromDataFactoryActivity">
        <dc:Bounds x="1050" y="230" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="DataStoreReference_1897i2u_di" bpmnElement="DataStoreReference_1897i2u">
        <dc:Bounds x="1075" y="365" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1064" y="422" width="72" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0v7rico_di" bpmnElement="searchOblastFromDataFactoryActivity">
        <dc:Bounds x="1330" y="230" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_03oltfd_di" bpmnElement="readOwnershipFromDataFactoryActivity">
        <dc:Bounds x="1470" y="230" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_12ftgyh_di" bpmnElement="readKopfgFromDataFactoryActivity">
        <dc:Bounds x="1610" y="230" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_185zjjw_di" bpmnElement="viewLabDataCitizenActivity" bioc:stroke="rgb(251, 140, 0)" bioc:fill="rgb(255, 224, 178)">
        <dc:Bounds x="1908" y="230" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1n8mv84_di" bpmnElement="updateLabCitizenActivity" bioc:stroke="rgb(251, 140, 0)" bioc:fill="rgb(255, 224, 178)">
        <dc:Bounds x="2138" y="230" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_0poyko1_di" bpmnElement="Gateway_0poyko1" isMarkerVisible="true">
        <dc:Bounds x="2043" y="245" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1jxdydp_di" bpmnElement="extractNameAndEdrpouFromUpdateLabFormActivity">
        <dc:Bounds x="2278" y="230" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_038bgls_di" bpmnElement="Gateway_038bgls" isMarkerVisible="true">
        <dc:Bounds x="2423" y="245" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="2422" y="200" width="60" height="40" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1qa6te9_di" bpmnElement="Gateway_1qa6te9" isMarkerVisible="true">
        <dc:Bounds x="2663" y="245" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="2651" y="305" width="74" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0nmo4bv_di" bpmnElement="Activity_00w3djy">
        <dc:Bounds x="2528" y="120" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1veuvsj_di" bpmnElement="searchForLabByNameAndEdrpouActivity">
        <dc:Bounds x="2520" y="230" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_030bh60_di" bpmnElement="readOblInfoFromDataFactoryActivity">
        <dc:Bounds x="1190" y="230" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_0gqiwsr_di" bpmnElement="Gateway_0gqiwsr" isMarkerVisible="true">
        <dc:Bounds x="2743" y="245" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0mn8k1x_di" bpmnElement="signLabCitizenActivity" bioc:stroke="rgb(251, 140, 0)" bioc:fill="rgb(255, 224, 178)">
        <dc:Bounds x="2825" y="230" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_07tb75z_di" bpmnElement="Activity_07tb75z" bioc:stroke="rgb(30, 136, 229)" bioc:fill="rgb(187, 222, 251)">
        <dc:Bounds x="2960" y="230" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0haqv4v_di" bpmnElement="dispatchTaskActivity" bioc:stroke="rgb(30, 136, 229)" bioc:fill="rgb(187, 222, 251)">
        <dc:Bounds x="3100" y="230" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1m00e6x_di" bpmnElement="Activity_1m00e6x" bioc:stroke="rgb(30, 136, 229)" bioc:fill="rgb(187, 222, 251)">
        <dc:Bounds x="3230" y="230" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="DataStoreReference_0sbg7eh_di" bpmnElement="DataStoreReference_0sbg7eh">
        <dc:Bounds x="1215" y="365" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1204" y="422" width="72" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="DataStoreReference_03zzx1o_di" bpmnElement="DataStoreReference_03zzx1o">
        <dc:Bounds x="1355" y="365" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1344" y="422" width="72" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="DataStoreReference_1bqcew5_di" bpmnElement="DataStoreReference_1bqcew5">
        <dc:Bounds x="1495" y="365" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1484" y="422" width="72" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="DataStoreReference_0v7wv16_di" bpmnElement="DataStoreReference_0v7wv16">
        <dc:Bounds x="1635" y="365" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1624" y="422" width="72" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_08sjnpn_di" bpmnElement="checkLabOfficerActivity" bioc:stroke="rgb(67, 160, 71)" bioc:fill="rgb(200, 230, 201)">
        <dc:Bounds x="3370" y="230" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_10n86l0_di" bpmnElement="Gateway_10n86l0" isMarkerVisible="true">
        <dc:Bounds x="3495" y="245" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="3476" y="173" width="88" height="53" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0ze90pn_di" bpmnElement="defineBusinessProcessStatusActivity">
        <dc:Bounds x="4208" y="230" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0xw0ca1_di" bpmnElement="Event_0xw0ca1">
        <dc:Bounds x="4370" y="252" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="4354" y="295" width="70" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="DataStoreReference_0ftohld_di" bpmnElement="DataStoreReference_0ftohld">
        <dc:Bounds x="4123" y="365" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="4112" y="422" width="72" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1828jrf_di" bpmnElement="updateLabInDataFactoryActivity">
        <dc:Bounds x="4080" y="230" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_12fj472_di" bpmnElement="Event_12fj472">
        <dc:Bounds x="4370" y="572" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="4346" y="615" width="85" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1r6wdr7_di" bpmnElement="Activity_1r6wdr7">
        <dc:Bounds x="4208" y="430" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1ndnthd_di" bpmnElement="Event_1ndnthd">
        <dc:Bounds x="4362" y="452" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="4338" y="495" width="85" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_02yv28o_di" bpmnElement="signLabOfficerActivity" bioc:stroke="rgb(67, 160, 71)" bioc:fill="rgb(200, 230, 201)">
        <dc:Bounds x="3720" y="230" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_053sdul_di" bpmnElement="Activity_053sdul">
        <dc:Bounds x="3840" y="230" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0i7keo5_di" bpmnElement="Activity_0i7keo5">
        <dc:Bounds x="3960" y="230" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1xtffx8_di" bpmnElement="Gateway_1xtffx8" isMarkerVisible="true">
        <dc:Bounds x="3595" y="245" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_18ns2is_di" bpmnElement="Gateway_18ns2is" isMarkerVisible="true">
        <dc:Bounds x="835" y="245" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_08hyjfl_di" bpmnElement="Gateway_08hyjfl" isMarkerVisible="true">
        <dc:Bounds x="445" y="245" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="434" y="305" width="72" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1uqfaz3_di" bpmnElement="Activity_1uqfaz3">
        <dc:Bounds x="300" y="230" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_14m2vl5_di" bpmnElement="Event_1x8mg0g">
        <dc:Bounds x="4112" y="212" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="DataOutputAssociation_1opc1nc_di" bpmnElement="DataOutputAssociation_1opc1nc">
        <di:waypoint x="968" y="310" />
        <di:waypoint x="968" y="360" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="DataOutputAssociation_02aoa2p_di" bpmnElement="DataOutputAssociation_02aoa2p">
        <di:waypoint x="1100" y="310" />
        <di:waypoint x="1100" y="365" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="DataOutputAssociation_082rwwv_di" bpmnElement="DataOutputAssociation_082rwwv">
        <di:waypoint x="1380" y="310" />
        <di:waypoint x="1380" y="360" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="DataOutputAssociation_1y4pmyb_di" bpmnElement="DataOutputAssociation_1y4pmyb">
        <di:waypoint x="1520" y="310" />
        <di:waypoint x="1520" y="360" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="DataOutputAssociation_14al9rj_di" bpmnElement="DataOutputAssociation_14al9rj">
        <di:waypoint x="1660" y="310" />
        <di:waypoint x="1660" y="365" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="DataOutputAssociation_0epgu5f_di" bpmnElement="DataOutputAssociation_0epgu5f">
        <di:waypoint x="1240" y="310" />
        <di:waypoint x="1240" y="365" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="DataOutputAssociation_13oebk7_di" bpmnElement="DataOutputAssociation_13oebk7">
        <di:waypoint x="4153" y="310" />
        <di:waypoint x="4153" y="365" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
