apiVersion: v1.edp.epam.com/v1alpha1
kind: KeycloakClient
metadata:
  annotations:
    helm.sh/resource-policy: keep
  name: {{ template "bpms.name" . }}-{{ .Values.keycloak.officerClient.clientName }}-{{ .Values.keycloak.officerClient.realm }}
  namespace: {{ .Values.namespace }}
spec:
  clientId: {{ .Values.keycloak.officerClient.clientName }}
  description: "Role for {{ template "bpms.name" . }} service"
  public: {{ .Values.keycloak.officerClient.public }}
  {{- if eq .Values.keycloak.officerClient.public false }}
  serviceAccount:
    enabled: true
    clientRoles: {{ .Values.keycloak.officerClient.serviceAccount.clientRoles | toYaml | nindent 4 }}
  secret: {{ .Values.keycloak.officerClient.secretName }}
  {{- else }}
  serviceAccount:
    enabled: false
  secret: ''
  {{- end }}
  directAccess: false
  audRequired: false
  {{- if .Values.keycloak.officerClient.clientRoles }}
  clientRoles:
    {{- range .Values.keycloak.officerClient.clientRoles }}
    - {{ . }}
    {{- end }}
  {{- end }}
  {{- if .Values.keycloak.officerClient.realmRoles }}
  realmRoles: {{ .Values.keycloak.officerClient.realmRoles | toYaml | nindent 4 }}
  {{- end }}
  {{- if .Values.keycloak.officerClient.protocolMappers }}
  protocolMappers: {{ .Values.keycloak.officerClient.protocolMappers | toYaml | nindent 4 }}
  {{- end }}
  targetRealm: {{ template "keycloak.officerTargetRealm" . }}
  webUrl: {{ template "bpms.url" . }}
